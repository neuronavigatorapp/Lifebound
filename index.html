<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lifebound Companion</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: #0a0a0f;
            color: white;
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            height: calc(100vh - 20px);
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            padding: 20px 0;
            border-bottom: 1px solid #333;
        }

        .title {
            font-size: 24px;
            font-weight: bold;
            color: #3b82f6;
        }

        .subtitle {
            color: #888;
            margin-top: 5px;
        }

        .chat {
            flex: 1;
            overflow-y: auto;
            padding: 15px 0;
            min-height: 300px;
        }

        .message {
            margin-bottom: 15px;
            padding: 12px;
            border-radius: 12px;
            max-width: 80%;
        }

        .user {
            background: #2563eb;
            margin-left: auto;
        }

        .companion {
            background: #1f2937;
            border: 1px solid #3b82f6;
        }

        .time {
            font-size: 11px;
            color: #999;
            margin-top: 5px;
        }

        .actions {
            padding: 10px 0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .action-btn {
            background: #374151;
            border: 1px solid #4b5563;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
        }

        .input-area {
            display: flex;
            gap: 10px;
            padding: 10px 0;
            border-top: 1px solid #333;
        }

        .input {
            flex: 1;
            background: #1f2937;
            border: 1px solid #374151;
            color: white;
            padding: 10px;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
        }

        .send {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }

        .send:disabled {
            background: #374151;
        }

        .status {
            text-align: center;
            font-size: 10px;
            color: #666;
            padding: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="title">LIFEBOUND</div>
            <div class="subtitle">Your Adventure Companion</div>
        </div>

        <div class="chat" id="chat">
            <!-- Messages appear here -->
        </div>

        <div class="actions">
            <button class="action-btn" onclick="quick('Im feeling overwhelmed')">Overwhelmed</button>
            <button class="action-btn" onclick="quick('I finished something!')">Victory!</button>
            <button class="action-btn" onclick="quick('What should I do next?')">Next Quest</button>
        </div>

        <div class="input-area">
            <input type="text" class="input" id="input" placeholder="Talk to your companion..." maxlength="500">
            <button class="send" id="send" onclick="send()">Send</button>
        </div>

        <div class="status" id="status">Ready</div>
    </div>

    <script>
        let messages = [];
        let memories = [];

        function init() {
            loadData();
            
            if (messages.length === 0) {
                addMessage("Hey there! I'm your adventure companion. I remember everything we do together and I'm here to help make life feel like the adventure it actually is. What's on your mind today?", 'companion');
            }
            
            updateDisplay();
            setupInput();
        }

        function loadData() {
            try {
                const saved = localStorage.getItem('lifebound_data');
                if (saved) {
                    const data = JSON.parse(saved);
                    messages = data.messages || [];
                    memories = data.memories || [];
                }
            } catch (e) {
                console.log('No saved data');
            }
        }

        function saveData() {
            try {
                const data = { messages, memories };
                localStorage.setItem('lifebound_data', JSON.stringify(data));
                updateStatus();
            } catch (e) {
                console.error('Save failed');
            }
        }

        function addMessage(text, type) {
            const msg = {
                id: Date.now(),
                text: text,
                type: type,
                time: new Date()
            };
            
            messages.push(msg);
            
            if (type === 'user' || type === 'companion') {
                memories.push({
                    content: type + ': ' + text,
                    time: new Date(),
                    emotion: detectEmotion(text)
                });
            }
            
            saveData();
            updateDisplay();
        }

        function detectEmotion(text) {
            const t = text.toLowerCase();
            if (t.includes('overwhelmed') || t.includes('stressed')) return 'overwhelmed';
            if (t.includes('done') || t.includes('finished')) return 'accomplished';
            if (t.includes('stuck') || t.includes('cant')) return 'stuck';
            if (t.includes('excited') || t.includes('great')) return 'excited';
            return 'neutral';
        }

        function generateResponse(input) {
            const text = input.toLowerCase();
            
            const recentStruggles = memories.filter(m => m.emotion === 'overwhelmed' || m.emotion === 'stuck').slice(-2);
            const recentWins = memories.filter(m => m.emotion === 'accomplished').slice(-3);

            if (text.includes('overwhelmed') || text.includes('too much')) {
                if (recentStruggles.length > 0) {
                    return "I remember you've been feeling overwhelmed lately. That's completely normal! Let's break this down together. What feels like the tiniest first step we could take right now?";
                }
                return "I can see you're feeling overwhelmed. That's totally normal! Want to pick just ONE small thing we can tackle together right now? We don't have to solve everything at once.";
            }
            
            if (text.includes('kitchen') || text.includes('dishes') || text.includes('cooking')) {
                return "Kitchen Realm adventure! I love exploring the Kitchen Realm with you. What's happening in there? Are we talking about a quick cleanup quest or something bigger?";
            }
            
            if (text.includes('tired') || text.includes('low energy')) {
                return "Low energy days are perfect for gentle quests. How about we find something small and satisfying? Even organizing one drawer counts as a victory with me!";
            }
            
            if (text.includes('done') || text.includes('finished') || text.includes('completed')) {
                return "YES! You DID that! I love celebrating victories with you. How did it feel to complete that quest? What should we tackle next, or do you want to rest and enjoy this win?";
            }

            if (text.includes('procrastinating') || text.includes('avoiding')) {
                return "Ah, the old Procrastination Dragon is visiting! I see them lurking around too sometimes. Want to team up against them? Sometimes the best strategy is making the task so small it's almost silly NOT to do it.";
            }

            if (recentWins.length > 0) {
                return "I'm here with you! I remember how accomplished you felt after your recent victories. Tell me what's going on in your world today - whether it's something you want to tackle or something you're avoiding, we can figure it out together.";
            }

            return "I'm here with you! Tell me what's going on in your world today. Whether it's something you want to tackle or something you're avoiding, we can figure it out together.";
        }

        function updateDisplay() {
            const chat = document.getElementById('chat');
            chat.innerHTML = '';
            
            messages.forEach(msg => {
                const div = document.createElement('div');
                div.className = 'message ' + msg.type;
                div.innerHTML = `
                    ${msg.text}
                    <div class="time">${new Date(msg.time).toLocaleTimeString()}</div>
                `;
                chat.appendChild(div);
            });
            
            chat.scrollTop = chat.scrollHeight;
        }

        function updateStatus() {
            document.getElementById('status').textContent = 
                `Messages: ${messages.length} | Memories: ${memories.length} | Last: ${new Date().toLocaleTimeString()}`;
        }

        function send() {
            const input = document.getElementById('input');
            const text = input.value.trim();
            
            if (!text) return;
            
            addMessage(text, 'user');
            input.value = '';
            
            // Show typing indicator
            addMessage('Your companion is thinking...', 'typing');
            
            setTimeout(() => {
                // Remove typing indicator
                messages = messages.filter(m => m.type !== 'typing');
                
                // Add response
                const response = generateResponse(text);
                addMessage(response, 'companion');
            }, 1000 + Math.random() * 1000);
        }

        function quick(text) {
            document.getElementById('input').value = text;
            send();
        }

        function setupInput() {
            const input = document.getElementById('input');
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    send();
                }
            });
            
            input.addEventListener('input', () => {
                document.getElementById('send').disabled = !input.value.trim();
            });
        }

        // Start the app
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
